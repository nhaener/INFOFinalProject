OB <- make_numeric(OB)
OB_S <- make_numeric(OB_S)
AC <- make_numeric(AC)
AC_S <- make_numeric(AC_S)
#############################################################
#############################################################
## Section to: add LL data to all files
#############################################################
#############################################################
OB_StCo <- OB[, c("State", "County")]
LL_StCo <- LL[, c("State", "County", "Lat", "Long")]
View(OB)
OB_StCo <- OB[, c("State", "County")]
LL_StCo <- LL[, c("State", "County", "Lat", "Long")]
joined <- left_join(OB_StCo, LL_StCo, by = c('State', 'County'))
View(joined)
View(OB_StCo)
View(OB_StCo)
View(LL_StCo)
View(LL_StCo)
OB_StCo <- OB # [, c("State", "County")]
LL_StCo <- LL[, c("State", "County", "Lat", "Long")]
joined <- left_join(OB_StCo, LL_StCo, by = c('State', 'County'))
View(OB)
View(OB)
###################################### Data Format Functions ###################################
#############################################################
#############################################################
## Functions for: correct column names of all files
#############################################################
#############################################################
# Format data function
format_data <- function(df, years, start, end) {
df_repeated_col <- get_last(df, 1, start, end)
df_col_names <- c("State", "FIPS_Codes", "County", years(df_repeated_col, years))
df <- fix_df(df, df_col_names)
return(df)
}
# Functions to add year to col names, return vector of strings
years <- function(col_values, years) {
values <- c()
for (int in years) {
values <- append(values, cn_year(col_values, int))
}
return(values)
}
cn_year <- function(col_values, year) {
values <- c()
for (string in col_values) {
values <- append(values, value_year(string, year))
}
return(values)
}
value_year <- function(value, year) {
return(paste(value, year, sep = "_"))
}
# function to get last value
get_last <- function(df, row, start, end) {
df <- df[row,start:end]
values <- c()
for (int in c(1:(end - start))) {
values <- append(values, as.character(factor(df[[row, int]])))
}
return(values)
}
# Functions to update data sets
fix_df <- function(df, new_colnames) {
colnames(df) <- new_colnames
return(df[-1,])
}
#############################################################
#############################################################
## Functions for: correct column names of all files
#############################################################
#############################################################
remove_cols <- function(df) {
df <- df %>% select(1:3, contains("number"), starts_with("percent"))
return(df)
}
#############################################################
#############################################################
## Functions for: correct column names of all files
#############################################################
#############################################################
make_numeric <- function(df) {
df_length <- ncol(df)
col_names <- c(df %>% select(4:df_length) %>% colnames())
values <- c()
for (string in col_names) {
df[,string] <- as.numeric(levels(df[, string]))[df[,string]]
}
return(df)
}
#############################################################
#############################################################
## Functions for: Adding Lat and Long data
#############################################################
#############################################################
add_location <- function(df, LL_df) {
LL_StCo <- LL_df[, c("State", "County", "Lat", "Long")]
joined <- left_join(df, LL_df, by = c('State', 'County'))
return(joined)
}
#############################################################
#############################################################
## This file will be used to organize our data sets into the
## format we need for our project.
##
## File name convention:
## OB <- Obesity Prevalence
## S <- sex
## AC <- Activity
## LL <- Lat & Long
## AB <- State Abbreviation names
##
## See google doc and/or issues for what needs to be done.
##
#############################################################
#############################################################
#############################################################
## Set working directory
# setwd("")
#############################################################
## Library
library(DataCombine)
library(dplyr)
#############################################################
#Source data formatting functions
source("format_functions.R")
#############################################################
## Reads in files to be worked on
LL <- read.csv("data/Lat_long_by_county.csv")
AB <- read.csv("data/StateName_abvr.csv")
OB <- read.csv("data/OB_PREV_ALL_STATES.csv")
OB_S <- read.csv("data/OB_PREV_by_sex_ALL_STATES.csv")
AC <- read.csv("data/LTPIA_PREV_ALL_STATES.csv")
AC_S <- read.csv("data/LTPIA_PREV_by_sex_ALL_STATES.csv")
#############################################################
#############################################################
## Section to work on LL and AB data
#############################################################
#############################################################
# Corrects LL to have full state name, requires DataCombine package
# to be loaded.
LL <- FindReplace(LL, "USPS", AB, from = "Abbreviation", to ="US.State",
exact = TRUE)
# Sets LL Column names
colnames(LL) <- c("State", "GEOID", "ANSICODE", "County", "Lat", "Long")
#############################################################
#############################################################
## Section to: correct column names of all files
#############################################################
#############################################################
# Formats column names for each file
OB <- format_data(OB, 2004:2012, 4, 11)
OB_S <- format_data(OB_S, 2009:2012, 4, 18)
AC <- format_data(AC, 2004:2012, 4, 11)
AC_S <- format_data(AC_S, 2009:2012, 4, 18)
#############################################################
#############################################################
## Section to: remove unnecessary information
#############################################################
#############################################################
OB <- remove_cols(OB)
OB_S <- remove_cols(OB_S)
AC <- remove_cols(OB_S)
AC_S <- remove_cols(OB_S)
#############################################################
#############################################################
## Section to: change percents and numbers to integer values
#############################################################
#############################################################
OB <- make_numeric(OB)
OB_S <- make_numeric(OB_S)
AC <- make_numeric(AC)
AC_S <- make_numeric(AC_S)
#############################################################
#############################################################
## Section to: add LL data to all files
#############################################################
#############################################################
OB <- add_location(OB)
OB_S <- add_location(OB_S)
AC <- add_location(AC)
AC_S <- ad_location(AC_S)
#############################################################
#############################################################
## This file will be used to organize our data sets into the
## format we need for our project.
##
## File name convention:
## OB <- Obesity Prevalence
## S <- sex
## AC <- Activity
## LL <- Lat & Long
## AB <- State Abbreviation names
##
## See google doc and/or issues for what needs to be done.
##
#############################################################
#############################################################
#############################################################
## Set working directory
# setwd("")
#############################################################
## Library
library(DataCombine)
library(dplyr)
#############################################################
#Source data formatting functions
source("format_functions.R")
#############################################################
## Reads in files to be worked on
LL <- read.csv("data/Lat_long_by_county.csv")
AB <- read.csv("data/StateName_abvr.csv")
OB <- read.csv("data/OB_PREV_ALL_STATES.csv")
OB_S <- read.csv("data/OB_PREV_by_sex_ALL_STATES.csv")
AC <- read.csv("data/LTPIA_PREV_ALL_STATES.csv")
AC_S <- read.csv("data/LTPIA_PREV_by_sex_ALL_STATES.csv")
#############################################################
#############################################################
## Section to work on LL and AB data
#############################################################
#############################################################
# Corrects LL to have full state name, requires DataCombine package
# to be loaded.
LL <- FindReplace(LL, "USPS", AB, from = "Abbreviation", to ="US.State",
exact = TRUE)
# Sets LL Column names
colnames(LL) <- c("State", "GEOID", "ANSICODE", "County", "Lat", "Long")
#############################################################
#############################################################
## Section to: correct column names of all files
#############################################################
#############################################################
# Formats column names for each file
OB <- format_data(OB, 2004:2012, 4, 11)
OB_S <- format_data(OB_S, 2009:2012, 4, 18)
AC <- format_data(AC, 2004:2012, 4, 11)
AC_S <- format_data(AC_S, 2009:2012, 4, 18)
#############################################################
#############################################################
## Section to: remove unnecessary information
#############################################################
#############################################################
OB <- remove_cols(OB)
OB_S <- remove_cols(OB_S)
AC <- remove_cols(OB_S)
AC_S <- remove_cols(OB_S)
#############################################################
#############################################################
## Section to: change percents and numbers to integer values
#############################################################
#############################################################
OB <- make_numeric(OB)
OB_S <- make_numeric(OB_S)
AC <- make_numeric(AC)
AC_S <- make_numeric(AC_S)
#############################################################
#############################################################
## Section to: add LL data to all files
#############################################################
#############################################################
OB <- add_location(OB)
OB_S <- add_location(OB_S)
AC <- add_location(AC)
AC_S <- add_location(AC_S)
#############################################################
#############################################################
## This file will be used to organize our data sets into the
## format we need for our project.
##
## File name convention:
## OB <- Obesity Prevalence
## S <- sex
## AC <- Activity
## LL <- Lat & Long
## AB <- State Abbreviation names
##
## See google doc and/or issues for what needs to be done.
##
#############################################################
#############################################################
#############################################################
## Set working directory
# setwd("")
#############################################################
## Library
library(DataCombine)
library(dplyr)
#############################################################
#Source data formatting functions
source("format_functions.R")
#############################################################
## Reads in files to be worked on
LL <- read.csv("data/Lat_long_by_county.csv")
AB <- read.csv("data/StateName_abvr.csv")
OB <- read.csv("data/OB_PREV_ALL_STATES.csv")
OB_S <- read.csv("data/OB_PREV_by_sex_ALL_STATES.csv")
AC <- read.csv("data/LTPIA_PREV_ALL_STATES.csv")
AC_S <- read.csv("data/LTPIA_PREV_by_sex_ALL_STATES.csv")
#############################################################
#############################################################
## Section to work on LL and AB data
#############################################################
#############################################################
# Corrects LL to have full state name, requires DataCombine package
# to be loaded.
LL <- FindReplace(LL, "USPS", AB, from = "Abbreviation", to ="US.State",
exact = TRUE)
# Sets LL Column names
colnames(LL) <- c("State", "GEOID", "ANSICODE", "County", "Lat", "Long")
#############################################################
#############################################################
## Section to: correct column names of all files
#############################################################
#############################################################
# Formats column names for each file
OB <- format_data(OB, 2004:2012, 4, 11)
OB_S <- format_data(OB_S, 2009:2012, 4, 18)
AC <- format_data(AC, 2004:2012, 4, 11)
AC_S <- format_data(AC_S, 2009:2012, 4, 18)
#############################################################
#############################################################
## Section to: remove unnecessary information
#############################################################
#############################################################
OB <- remove_cols(OB)
OB_S <- remove_cols(OB_S)
AC <- remove_cols(OB_S)
AC_S <- remove_cols(OB_S)
#############################################################
#############################################################
## Section to: change percents and numbers to integer values
#############################################################
#############################################################
OB <- make_numeric(OB)
OB_S <- make_numeric(OB_S)
AC <- make_numeric(AC)
AC_S <- make_numeric(AC_S)
#############################################################
#############################################################
## Section to: add LL data to all files
#############################################################
#############################################################
OB <- add_location(OB, LL)
OB_S <- add_location(OB_S, LL)
AC <- add_location(AC, LL)
AC_S <- add_location(AC_S, LL)
View(OB)
###################################### Data Format Functions ###################################
#############################################################
#############################################################
## Functions for: correct column names of all files
#############################################################
#############################################################
# Format data function
format_data <- function(df, years, start, end) {
df_repeated_col <- get_last(df, 1, start, end)
df_col_names <- c("State", "FIPS_Codes", "County", years(df_repeated_col, years))
df <- fix_df(df, df_col_names)
return(df)
}
# Functions to add year to col names, return vector of strings
years <- function(col_values, years) {
values <- c()
for (int in years) {
values <- append(values, cn_year(col_values, int))
}
return(values)
}
cn_year <- function(col_values, year) {
values <- c()
for (string in col_values) {
values <- append(values, value_year(string, year))
}
return(values)
}
value_year <- function(value, year) {
return(paste(value, year, sep = "_"))
}
# function to get last value
get_last <- function(df, row, start, end) {
df <- df[row,start:end]
values <- c()
for (int in c(1:(end - start))) {
values <- append(values, as.character(factor(df[[row, int]])))
}
return(values)
}
# Functions to update data sets
fix_df <- function(df, new_colnames) {
colnames(df) <- new_colnames
return(df[-1,])
}
#############################################################
#############################################################
## Functions for: correct column names of all files
#############################################################
#############################################################
remove_cols <- function(df) {
df <- df %>% select(1:3, contains("number"), starts_with("percent"))
return(df)
}
#############################################################
#############################################################
## Functions for: correct column names of all files
#############################################################
#############################################################
make_numeric <- function(df) {
df_length <- ncol(df)
col_names <- c(df %>% select(4:df_length) %>% colnames())
values <- c()
for (string in col_names) {
df[,string] <- as.numeric(levels(df[, string]))[df[,string]]
}
return(df)
}
#############################################################
#############################################################
## Functions for: Adding Lat and Long data
#############################################################
#############################################################
add_location <- function(df, LL_df) {
LL_StCo <- LL_df[, c("State", "County", "Lat", "Long")]
joined <- left_join(df, LL_StCo, by = c('State', 'County'))
return(joined)
}
#############################################################
#############################################################
## This file will be used to organize our data sets into the
## format we need for our project.
##
## File name convention:
## OB <- Obesity Prevalence
## S <- sex
## AC <- Activity
## LL <- Lat & Long
## AB <- State Abbreviation names
##
## See google doc and/or issues for what needs to be done.
##
#############################################################
#############################################################
#############################################################
## Set working directory
# setwd("")
#############################################################
## Library
library(DataCombine)
library(dplyr)
#############################################################
#Source data formatting functions
source("format_functions.R")
#############################################################
## Reads in files to be worked on
LL <- read.csv("data/Lat_long_by_county.csv")
AB <- read.csv("data/StateName_abvr.csv")
OB <- read.csv("data/OB_PREV_ALL_STATES.csv")
OB_S <- read.csv("data/OB_PREV_by_sex_ALL_STATES.csv")
AC <- read.csv("data/LTPIA_PREV_ALL_STATES.csv")
AC_S <- read.csv("data/LTPIA_PREV_by_sex_ALL_STATES.csv")
#############################################################
#############################################################
## Section to work on LL and AB data
#############################################################
#############################################################
# Corrects LL to have full state name, requires DataCombine package
# to be loaded.
LL <- FindReplace(LL, "USPS", AB, from = "Abbreviation", to ="US.State",
exact = TRUE)
# Sets LL Column names
colnames(LL) <- c("State", "GEOID", "ANSICODE", "County", "Lat", "Long")
#############################################################
#############################################################
## Section to: correct column names of all files
#############################################################
#############################################################
# Formats column names for each file
OB <- format_data(OB, 2004:2012, 4, 11)
OB_S <- format_data(OB_S, 2009:2012, 4, 18)
AC <- format_data(AC, 2004:2012, 4, 11)
AC_S <- format_data(AC_S, 2009:2012, 4, 18)
#############################################################
#############################################################
## Section to: remove unnecessary information
#############################################################
#############################################################
OB <- remove_cols(OB)
OB_S <- remove_cols(OB_S)
AC <- remove_cols(OB_S)
AC_S <- remove_cols(OB_S)
#############################################################
#############################################################
## Section to: change percents and numbers to integer values
#############################################################
#############################################################
OB <- make_numeric(OB)
OB_S <- make_numeric(OB_S)
AC <- make_numeric(AC)
AC_S <- make_numeric(AC_S)
#############################################################
#############################################################
## Section to: add LL data to all files
#############################################################
#############################################################
OB <- add_location(OB, LL)
OB_S <- add_location(OB_S, LL)
AC <- add_location(AC, LL)
AC_S <- add_location(AC_S, LL)
View(OB)
View(OB)
